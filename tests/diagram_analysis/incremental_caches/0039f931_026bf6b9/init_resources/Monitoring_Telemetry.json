{
  "description": "The Monitoring & Telemetry subsystem captures, aggregates, and persists operational metrics and usage statistics for LLM interactions and agent execution. Its main flow begins with event interception from runtime components (LLM calls, tool executions), processes those events via a monitoring event handler which extracts metrics, aggregates them in a runtime statistics aggregator within the context of a monitoring session, and finally persists summarized metrics to storage using a streaming writer. Utility functions provide consistent run IDs and file path resolution to organize outputs, while a public integration API (MonitoringMixin) exposes monitoring hooks and aggregated statistics to other system components.",
  "components": [
    {
      "name": "Monitoring Integration API",
      "description": "Public-facing interface and reusable mixin for other system components to enable monitoring. Provides configured monitoring callbacks and access to aggregated statistics without tight coupling.",
      "key_entities": [
        {
          "qualified_name": "monitoring.integration.MonitoringMixin",
          "reference_file": "monitoring/__init__.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "monitoring/__init__.py",
        "monitoring/mixin.py"
      ],
      "source_cluster_ids": [],
      "can_expand": true
    },
    {
      "name": "Monitoring Event Handler",
      "description": "Primary event listener that intercepts operational events from LLM interactions and tool executions, extracts metrics (tokens, durations, errors), and forwards them for aggregation.",
      "key_entities": [
        {
          "qualified_name": "monitoring.callbacks.MonitoringCallback",
          "reference_file": "monitoring/callbacks.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "monitoring/callbacks.py"
      ],
      "source_cluster_ids": [],
      "can_expand": true
    },
    {
      "name": "Runtime Statistics Aggregator",
      "description": "Manages in-memory aggregation of metrics for a single run (RunStats), accumulating token counts, tool call counts, latencies, and errors to produce a consolidated view of run performance.",
      "key_entities": [
        {
          "qualified_name": "monitoring.stats.RunStats",
          "reference_file": "monitoring/stats.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "monitoring/stats.py"
      ],
      "source_cluster_ids": [],
      "can_expand": true
    },
    {
      "name": "Monitoring Session Manager",
      "description": "Orchestrates the lifecycle of monitoring sessions (MonitoringContext), including creation and management of RunStats instances, tracking start/end times, and ensuring unique identification for each run.",
      "key_entities": [
        {
          "qualified_name": "monitoring.context.MonitoringContext",
          "reference_file": "monitoring/context.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "monitoring/context.py"
      ],
      "source_cluster_ids": [],
      "can_expand": true
    },
    {
      "name": "Monitoring Path & ID Resolver",
      "description": "Utilities for generating unique run identifiers and resolving file paths for monitoring outputs, ensuring consistent and organized storage of telemetry data.",
      "key_entities": [
        {
          "qualified_name": "monitoring.paths",
          "reference_file": "monitoring/paths.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "monitoring/paths.py"
      ],
      "source_cluster_ids": [],
      "can_expand": true
    },
    {
      "name": "Streaming Data Persister",
      "description": "Persists aggregated monitoring data to storage (StreamingStatsWriter) by retrieving finalized statistics and writing them to designated output locations for later analysis.",
      "key_entities": [
        {
          "qualified_name": "monitoring.writers.StreamingStatsWriter",
          "reference_file": "monitoring/writers.py",
          "reference_start_line": null,
          "reference_end_line": null
        }
      ],
      "assigned_files": [
        "monitoring/writers.py"
      ],
      "source_cluster_ids": [],
      "can_expand": true
    }
  ],
  "components_relations": [
    {
      "relation": "provides",
      "src_name": "Monitoring Integration API",
      "dst_name": "Monitoring Event Handler"
    },
    {
      "relation": "exposes",
      "src_name": "Monitoring Integration API",
      "dst_name": "Runtime Statistics Aggregator"
    },
    {
      "relation": "updates",
      "src_name": "Monitoring Event Handler",
      "dst_name": "Runtime Statistics Aggregator"
    },
    {
      "relation": "is configured by",
      "src_name": "Monitoring Event Handler",
      "dst_name": "Monitoring Integration API"
    },
    {
      "relation": "receives updates from",
      "src_name": "Runtime Statistics Aggregator",
      "dst_name": "Monitoring Event Handler"
    },
    {
      "relation": "is managed by",
      "src_name": "Runtime Statistics Aggregator",
      "dst_name": "Monitoring Session Manager"
    },
    {
      "relation": "creates & manages",
      "src_name": "Monitoring Session Manager",
      "dst_name": "Runtime Statistics Aggregator"
    },
    {
      "relation": "consults",
      "src_name": "Monitoring Session Manager",
      "dst_name": "Monitoring Path & ID Resolver"
    },
    {
      "relation": "serves",
      "src_name": "Monitoring Path & ID Resolver",
      "dst_name": "Monitoring Session Manager"
    },
    {
      "relation": "serves",
      "src_name": "Monitoring Path & ID Resolver",
      "dst_name": "Streaming Data Persister"
    },
    {
      "relation": "retrieves data from",
      "src_name": "Streaming Data Persister",
      "dst_name": "Runtime Statistics Aggregator"
    },
    {
      "relation": "consults",
      "src_name": "Streaming Data Persister",
      "dst_name": "Monitoring Path & ID Resolver"
    }
  ]
}